<div class="container mt-3">
  <div class="container mt-5">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5>Issue Details</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <p><strong>Tracking Number:</strong> {{ issue?.tracking_number }}</p>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <p><strong>Title:</strong> {{ issue?.title }}</p>
          </div>
          <div class="col-md-6">
            <p><strong>Category:</strong> {{ issue?.issueCategory }}</p>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <p><strong>Description:</strong> {{ issue?.description }}</p>
          </div>
          <div class="col-md-6">
            <p><strong>Status:</strong> {{ issue?.status }}</p>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <p><strong>Office ID:</strong> {{ issue?.office }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Replies Section -->
    <div class="card mt-4">
      <div class="card-header bg-secondary text-white">
        <h5>Replies</h5>
      </div>
      <div class="card-body">
        <div *ngIf="replies.length > 0; else noReplies">
          <div class="reply" *ngFor="let reply of replies">
            <div class="border-bottom pb-2 mb-2">
              <p><strong>{{ reply.postedBy }}</strong> - {{ reply.postedOn | date: 'short' }}</p>
              <p>{{ reply.message }}</p>
            </div>
          </div>
        </div>
        <ng-template #noReplies>
          <p>No replies yet. Be the first to respond!</p>
        </ng-template>
      </div>
    </div>

    <!-- Reply Form -->
    <div *ngIf="isAdminAndisNotSelf()" class="card mt-3">
      <div class="card-header bg-light">
        <h5>Post a Reply</h5>
      </div>
      <div class="card-body">
        <form (ngSubmit)="postReply()">
          <div class="form-group">
        <textarea
          [(ngModel)]="newReply.message"
          name="message"
          class="form-control"
          rows="3"
          placeholder="Write your reply..."
          required
        ></textarea>
          </div>
          <div class="d-flex justify-content-end align-items-end">
            <!-- Dropdown -->
            <div class="mx-3">
              <select
                [(ngModel)]="newReply.status"
                name="status"
                class="form-select"
                [ngClass]="getStatusColor()"
                required>
                <option value="" disabled>Select Status</option>
                <option value="OPENED">OPENED</option>
                <option value="RESOLVED">RESOLVED</option>
                <option value="REJECTED">REJECTED</option>
                <option value="PENDING">PENDING</option>
              </select>
            </div>
            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary mt-2">Submit Reply</button>
          </div>
        </form>
      </div>
    </div>

  </div>

  <ng-template #notFound>
    <div class="alert alert-danger">
      <strong>Error:</strong> Issue not found!
    </div>
  </ng-template>
</div>
